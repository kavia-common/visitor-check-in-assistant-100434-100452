{"is_source_file": true, "format": "Python", "description": "This file is the main FastAPI application for a Visitor Management Kiosk backend. It defines API endpoints for visitor check-in (including conversational steps), OCR upload for ID documents, speech-to-text and text-to-speech services, notifications, admin data retrieval, and real-time field validation. It integrates with database models (Visitor, VisitLog, Host, AdminUser), AI services for OCR and speech, and includes middleware and schema definitions.", "external_files": ["from .database import get_db", "from .models import Visitor, VisitLog, Host, AdminUser", "from .ai_services import perform_ocr_on_image, perform_speech_to_text, perform_text_to_speech"], "external_methods": ["get_db", "perform_ocr_on_image", "perform_speech_to_text", "perform_text_to_speech"], "published": ["app"], "classes": [{"name": "VisitorCheckinStepRequest", "description": "Pydantic model representing a conversation step request in visitor check-in."}, {"name": "VisitorCheckinStepResponse", "description": "Pydantic model representing the response to a check-in step, including next prompt and state."}, {"name": "VisitorCreatePayload", "description": "Pydantic model for creating a new visitor record."}, {"name": "VisitorOut", "description": "Pydantic model for representing visitor data in API responses."}, {"name": "HostOut", "description": "Pydantic model for host data."}, {"name": "VisitLogOut", "description": "Pydantic model for visit log data."}, {"name": "AdminUserOut", "description": "Pydantic model for admin user data."}, {"name": "FieldValidationRequest", "description": "Pydantic model for field validation requests."}, {"name": "FieldValidationResult", "description": "Pydantic model for validation results."}, {"name": "SpeechRequest", "description": "Pydantic model for speech-related API requests (STT)."}, {"name": "TextToSpeechRequest", "description": "Pydantic model for TTS API requests."}], "methods": [{"name": "health_check()", "description": "Basic health check endpoint returning 'Healthy'.", "scope": "", "scopeKind": ""}, {"name": "visitor_checkin_step(payload: VisitorCheckinStepRequest)", "description": "Handles a conversational step in visitor check-in, returns next prompt and updates conversation state.", "scope": "", "scopeKind": ""}, {"name": "visitor_checkin_finalize(payload: Dict[str, Any], db: Session = Depends(get_db))", "description": "Finalizes visitor check-in by creating or retrieving visitor, host, and log records; returns the visit log.", "scope": "", "scopeKind": ""}, {"name": "upload_id_ocr(file: UploadFile = File(...))", "description": "Receives an ID image file, performs OCR (via external service), and returns extracted fields or fallback.", "scope": "", "scopeKind": ""}, {"name": "speech_to_text_stub(file: UploadFile = File(...), language: Optional[str] = Form(\"en-US\"))", "description": "Accepts audio upload, performs speech-to-text, and returns transcript.", "scope": "", "scopeKind": ""}, {"name": "text_to_speech_stub(request: TextToSpeechRequest)", "description": "Converts text to speech audio stream (TTS).", "scope": "", "scopeKind": ""}, {"name": "notify_host(body: Dict[str, Any] = Body(...))", "description": "Stub API to trigger notifications to host (e.g., SMS or email).", "scope": "", "scopeKind": ""}, {"name": "get_visitors(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))", "description": "Retrieve list of visitors (admin dashboard).", "scope": "", "scopeKind": ""}, {"name": "get_visitlogs(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))", "description": "Retrieve list of visit logs.", "scope": "", "scopeKind": ""}, {"name": "get_hosts(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))", "description": "Retrieve list of hosts.", "scope": "", "scopeKind": ""}, {"name": "get_admin_users(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))", "description": "Retrieve list of admin users.", "scope": "", "scopeKind": ""}, {"name": "validate_field(payload: FieldValidationRequest)", "description": "Performs real-time validation of a specific field (e.g., email, phone).", "scope": "", "scopeKind": ""}, {"name": "websocket_usage()", "description": "Provides information on how to use WebSocket for real-time features (for documentation).", "scope": "", "scopeKind": ""}], "calls": ["get_db", "perform_ocr_on_image", "perform_speech_to_text", "perform_text_to_speech"], "search-terms": ["visitor_checkin_step", "OCR upload", "ID OCR", "conversational check-in", "speech API", "text-to-speech", "admin dashboard", "visit log", "host notification", "field validation"], "state": 2, "file_id": 3, "knowledge_revision": 23, "git_revision": "5d78805231013048f04ab2ecc6a8f5e966a88111", "revision_history": [{"8": "6f8d14138a31a8de1833fb74718a484347053381"}, {"18": "74645588330024a5ea7b3e4fa3283c127dbec88e"}, {"19": "74645588330024a5ea7b3e4fa3283c127dbec88e"}, {"22": "74645588330024a5ea7b3e4fa3283c127dbec88e"}, {"23": "5d78805231013048f04ab2ecc6a8f5e966a88111"}], "ctags": [{"_type": "tag", "name": "AdminUserOut", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class AdminUserOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "Config", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    class Config:$/", "language": "Python", "kind": "class", "scope": "AdminUserOut", "scopeKind": "class"}, {"_type": "tag", "name": "Config", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    class Config:$/", "language": "Python", "kind": "class", "scope": "HostOut", "scopeKind": "class"}, {"_type": "tag", "name": "Config", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    class Config:$/", "language": "Python", "kind": "class", "scope": "VisitLogOut", "scopeKind": "class"}, {"_type": "tag", "name": "Config", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    class Config:$/", "language": "Python", "kind": "class", "scope": "VisitorOut", "scopeKind": "class"}, {"_type": "tag", "name": "FieldValidationRequest", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class FieldValidationRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "FieldValidationResult", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class FieldValidationResult(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "HostOut", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class HostOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "SpeechRequest", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class SpeechRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "TextToSpeechRequest", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class TextToSpeechRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "VisitLogOut", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class VisitLogOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "VisitorCheckinStepRequest", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class VisitorCheckinStepRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "VisitorCheckinStepResponse", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class VisitorCheckinStepResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "VisitorCreatePayload", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class VisitorCreatePayload(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "VisitorOut", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class VisitorOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "advice", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    advice: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "VisitorCheckinStepResponse", "scopeKind": "class"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "audio_data", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    audio_data: bytes = Field(..., description=\"Audio file bytes (base64-encoded or binary, but /", "language": "Python", "typeref": "typename:bytes", "kind": "variable", "scope": "SpeechRequest", "scopeKind": "class"}, {"_type": "tag", "name": "conversation_state", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    conversation_state: Dict[str, str] = Field(..., description=\"Collected data so far (may be p/", "language": "Python", "typeref": "typename:Dict[str, str]", "kind": "variable", "scope": "VisitorCheckinStepRequest", "scopeKind": "class"}, {"_type": "tag", "name": "errors", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    errors: Optional[List[str]] = None$/", "language": "Python", "typeref": "typename:Optional[List[str]]", "kind": "variable", "scope": "FieldValidationResult", "scopeKind": "class"}, {"_type": "tag", "name": "errors", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    errors: Optional[List[str]] = None$/", "language": "Python", "typeref": "typename:Optional[List[str]]", "kind": "variable", "scope": "VisitorCheckinStepResponse", "scopeKind": "class"}, {"_type": "tag", "name": "field", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    field: str = Field(..., description=\"'email', 'phone', or other field name to validate\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "FieldValidationRequest", "scopeKind": "class"}, {"_type": "tag", "name": "full_name", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    full_name: str = Field(..., example=\"Alice Smith\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "VisitorCreatePayload", "scopeKind": "class"}, {"_type": "tag", "name": "get_admin_users", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def get_admin_users(skip: int = 0, limit: int = 25, db: Session = Depends(get_db)):$/", "language": "Python", "kind": "function", "signature": "(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))"}, {"_type": "tag", "name": "get_hosts", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def get_hosts(skip: int = 0, limit: int = 25, db: Session = Depends(get_db)):$/", "language": "Python", "kind": "function", "signature": "(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))"}, {"_type": "tag", "name": "get_visitlogs", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def get_visitlogs(skip: int = 0, limit: int = 25, db: Session = Depends(get_db)):$/", "language": "Python", "kind": "function", "signature": "(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))"}, {"_type": "tag", "name": "get_visitors", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def get_visitors(skip: int = 0, limit: int = 25, db: Session = Depends(get_db)):$/", "language": "Python", "kind": "function", "signature": "(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "input_mode", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    input_mode: str = Field(..., description=\"'voice' or 'text'\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "VisitorCheckinStepRequest", "scopeKind": "class"}, {"_type": "tag", "name": "is_complete", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    is_complete: bool = False$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "VisitorCheckinStepResponse", "scopeKind": "class"}, {"_type": "tag", "name": "language", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    language: Optional[str] = Field(\"en\", description=\"Language code for STT\\/TTS\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "SpeechRequest", "scopeKind": "class"}, {"_type": "tag", "name": "language", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    language: Optional[str] = Field(\"en\", description=\"Language code for TTS\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "TextToSpeechRequest", "scopeKind": "class"}, {"_type": "tag", "name": "next_field", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    next_field: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "VisitorCheckinStepResponse", "scopeKind": "class"}, {"_type": "tag", "name": "notify_host", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def notify_host(body: Dict[str, Any] = Body(...)):$/", "language": "Python", "kind": "function", "signature": "(body: Dict[str, Any] = Body(...))"}, {"_type": "tag", "name": "orm_mode", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^        orm_mode = True$/", "language": "Python", "kind": "variable", "scope": "AdminUserOut.Config", "scopeKind": "class"}, {"_type": "tag", "name": "orm_mode", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^        orm_mode = True$/", "language": "Python", "kind": "variable", "scope": "HostOut.Config", "scopeKind": "class"}, {"_type": "tag", "name": "orm_mode", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^        orm_mode = True$/", "language": "Python", "kind": "variable", "scope": "VisitLogOut.Config", "scopeKind": "class"}, {"_type": "tag", "name": "orm_mode", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^        orm_mode = True$/", "language": "Python", "kind": "variable", "scope": "VisitorOut.Config", "scopeKind": "class"}, {"_type": "tag", "name": "speech_to_text_stub", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^async def speech_to_text_stub(file: UploadFile = File(...), language: Optional[str] = Form(\"en-U/", "language": "Python", "kind": "function", "signature": "(file: UploadFile = File(...), language: Optional[str] = Form(\"en-US\"))"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    text: str = Field(..., description=\"Text to convert to speech\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "TextToSpeechRequest", "scopeKind": "class"}, {"_type": "tag", "name": "text_to_speech_stub", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^async def text_to_speech_stub(request: TextToSpeechRequest):$/", "language": "Python", "kind": "function", "signature": "(request: TextToSpeechRequest)"}, {"_type": "tag", "name": "upload_id_ocr", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^async def upload_id_ocr(file: UploadFile = File(...)):$/", "language": "Python", "kind": "function", "signature": "(file: UploadFile = File(...))"}, {"_type": "tag", "name": "user_input", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    user_input: str = Field(..., description=\"Current raw input (spoken or typed)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "VisitorCheckinStepRequest", "scopeKind": "class"}, {"_type": "tag", "name": "validate_field", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def validate_field(payload: FieldValidationRequest):$/", "language": "Python", "kind": "function", "signature": "(payload: FieldValidationRequest)"}, {"_type": "tag", "name": "visitor_checkin_finalize", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def visitor_checkin_finalize(payload: Dict[str, Any], db: Session = Depends(get_db)):$/", "language": "Python", "kind": "function", "signature": "(payload: Dict[str, Any], db: Session = Depends(get_db))"}, {"_type": "tag", "name": "visitor_checkin_step", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def visitor_checkin_step(payload: VisitorCheckinStepRequest):$/", "language": "Python", "kind": "function", "signature": "(payload: VisitorCheckinStepRequest)"}, {"_type": "tag", "name": "websocket_usage", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def websocket_usage():$/", "language": "Python", "kind": "function", "signature": "()"}], "hash": "b413e88223ea319d821f84becbea5c21", "format-version": 4, "code-base-name": "visitor_management_backend", "filename": "visitor_management_backend/src/api/main.py", "fields": [{"name": "Optional[str] advice", "scope": "VisitorCheckinStepResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bytes audio_data", "scope": "SpeechRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Dict[str, str] conversation_state", "scope": "VisitorCheckinStepRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[List[str]] errors", "scope": "FieldValidationResult", "scopeKind": "class", "description": "unavailable"}, {"name": "str field", "scope": "FieldValidationRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str full_name", "scope": "VisitorCreatePayload", "scopeKind": "class", "description": "unavailable"}, {"name": "str input_mode", "scope": "VisitorCheckinStepRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "bool is_complete", "scope": "VisitorCheckinStepResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] language", "scope": "SpeechRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] next_field", "scope": "VisitorCheckinStepResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "orm_mode = True", "scope": "AdminUserOut.Config", "scopeKind": "class", "description": "unavailable"}, {"name": "str text", "scope": "TextToSpeechRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str user_input", "scope": "VisitorCheckinStepRequest", "scopeKind": "class", "description": "unavailable"}]}