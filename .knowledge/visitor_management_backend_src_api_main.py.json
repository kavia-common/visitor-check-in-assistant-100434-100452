{"is_source_file": true, "format": "Python (FastAPI framework)", "description": "This file implements a backend API server for a visitor management system using FastAPI. It provides endpoints for visitor check-in workflows, OCR image upload, speech processing (STT/TTS), notifications, admin data retrieval, and real-time field validation. The API is structured with multiple routes, uses Pydantic schemas for validation, and integrates with database models for visitors, hosts, and visit logs.", "external_files": ["database", "models", "ai_services"], "external_methods": ["get_db", "Visitor", "VisitLog", "Host", "AdminUser", "perform_ocr_on_image", "perform_speech_to_text", "perform_text_to_speech"], "published": ["app"], "classes": [{"name": "VisitorCheckinStepRequest", "description": "Schema for input during the conversational visitor check-in process, capturing conversation state and user input."}, {"name": "VisitorCheckinStepResponse", "description": "Schema for the response in the check-in step API, including prompts, state, and completion status."}, {"name": "VisitorCreatePayload", "description": "Schema for creating or updating visitor data."}, {"name": "VisitorOut", "description": "Schema representing visitor data sent to clients."}, {"name": "HostOut", "description": "Schema representing host data."}, {"name": "VisitLogOut", "description": "Schema representing visit log details including visitor and host info."}, {"name": "AdminUserOut", "description": "Schema representing admin user data."}, {"name": "FieldValidationRequest", "description": "Schema for validation API requests for specific fields."}, {"name": "FieldValidationResult", "description": "Schema for validation results, indicating validity and errors."}, {"name": "SpeechRequest", "description": "Schema for speech-to-text requests containing audio data."}, {"name": "TextToSpeechRequest", "description": "Schema for text-to-speech requests."}], "methods": [{"name": "health_check()", "description": "Health check endpoint returning API status.", "scope": "", "scopeKind": ""}, {"name": "visitor_checkin_step(payload: VisitorCheckinStepRequest)", "description": "Handles a step in the conversational visitor check-in process, providing prompts and collecting data.", "scope": "", "scopeKind": ""}, {"name": "visitor_checkin_finalize(payload: Dict[str, Any], db: Session = Depends(get_db))", "description": "Finalizes visitor check-in, creating related database entries and returning the visit log.", "scope": "", "scopeKind": ""}, {"name": "upload_id_ocr(file: UploadFile = File(...))", "description": "Stub endpoint for uploading ID images and extracting data via OCR.", "scope": "", "scopeKind": ""}, {"name": "speech_to_text_stub(file: UploadFile = File(...), language: Optional[str] = Form(\"en-US\"))", "description": "Stub endpoint for converting speech audio to text.", "scope": "", "scopeKind": ""}, {"name": "text_to_speech_stub(request: TextToSpeechRequest)", "description": "Stub endpoint for converting text to speech audio.", "scope": "", "scopeKind": ""}, {"name": "notify_host(body: Dict[str, Any] = Body(...))", "description": "Stub for triggering notifications to a host about a visitor.", "scope": "", "scopeKind": ""}, {"name": "get_visitors(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))", "description": "Retrieves paginated list of visitors.", "scope": "", "scopeKind": ""}, {"name": "get_visitlogs(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))", "description": "Retrieves paginated list of visit logs.", "scope": "", "scopeKind": ""}, {"name": "get_hosts(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))", "description": "Retrieves list of hosts.", "scope": "", "scopeKind": ""}, {"name": "get_admin_users(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))", "description": "Retrieves list of admin users.", "scope": "", "scopeKind": ""}, {"name": "validate_field(payload: FieldValidationRequest)", "description": "Performs real-time validation for specific form fields.", "scope": "", "scopeKind": ""}, {"name": "websocket_usage()", "description": "Provides API documentation on WebSocket usage (although not implemented here).", "scope": "", "scopeKind": ""}], "calls": ["get_db", "Visitor.query", "Host.query", "VisitLog.query", "AdminUser.query", "perform_ocr_on_image", "perform_speech_to_text", "perform_text_to_speech"], "search-terms": ["visitor check-in", "OCR ID upload", "speech STT TTS", "visit logs", "admin dashboard", "notifications", "validation", "FastAPI", "visitor management backend"], "state": 2, "file_id": 3, "knowledge_revision": 22, "git_revision": "74645588330024a5ea7b3e4fa3283c127dbec88e", "revision_history": [{"8": "6f8d14138a31a8de1833fb74718a484347053381"}, {"18": "74645588330024a5ea7b3e4fa3283c127dbec88e"}, {"19": "74645588330024a5ea7b3e4fa3283c127dbec88e"}, {"22": "74645588330024a5ea7b3e4fa3283c127dbec88e"}], "ctags": [{"_type": "tag", "name": "AdminUserOut", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class AdminUserOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "Config", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    class Config:$/", "language": "Python", "kind": "class", "scope": "AdminUserOut", "scopeKind": "class"}, {"_type": "tag", "name": "Config", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    class Config:$/", "language": "Python", "kind": "class", "scope": "HostOut", "scopeKind": "class"}, {"_type": "tag", "name": "Config", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    class Config:$/", "language": "Python", "kind": "class", "scope": "VisitLogOut", "scopeKind": "class"}, {"_type": "tag", "name": "Config", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    class Config:$/", "language": "Python", "kind": "class", "scope": "VisitorOut", "scopeKind": "class"}, {"_type": "tag", "name": "FieldValidationRequest", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class FieldValidationRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "FieldValidationResult", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class FieldValidationResult(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "HostOut", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class HostOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "SpeechRequest", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class SpeechRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "TextToSpeechRequest", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class TextToSpeechRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "VisitLogOut", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class VisitLogOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "VisitorCheckinStepRequest", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class VisitorCheckinStepRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "VisitorCheckinStepResponse", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class VisitorCheckinStepResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "VisitorCreatePayload", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class VisitorCreatePayload(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "VisitorOut", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^class VisitorOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "advice", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    advice: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "VisitorCheckinStepResponse", "scopeKind": "class"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "audio_data", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    audio_data: bytes = Field(..., description=\"Audio file bytes (base64-encoded or binary, but /", "language": "Python", "typeref": "typename:bytes", "kind": "variable", "scope": "SpeechRequest", "scopeKind": "class"}, {"_type": "tag", "name": "conversation_state", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    conversation_state: Dict[str, str] = Field(..., description=\"Collected data so far (may be p/", "language": "Python", "typeref": "typename:Dict[str, str]", "kind": "variable", "scope": "VisitorCheckinStepRequest", "scopeKind": "class"}, {"_type": "tag", "name": "errors", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    errors: Optional[List[str]] = None$/", "language": "Python", "typeref": "typename:Optional[List[str]]", "kind": "variable", "scope": "FieldValidationResult", "scopeKind": "class"}, {"_type": "tag", "name": "errors", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    errors: Optional[List[str]] = None$/", "language": "Python", "typeref": "typename:Optional[List[str]]", "kind": "variable", "scope": "VisitorCheckinStepResponse", "scopeKind": "class"}, {"_type": "tag", "name": "field", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    field: str = Field(..., description=\"'email', 'phone', or other field name to validate\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "FieldValidationRequest", "scopeKind": "class"}, {"_type": "tag", "name": "full_name", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    full_name: str = Field(..., example=\"Alice Smith\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "VisitorCreatePayload", "scopeKind": "class"}, {"_type": "tag", "name": "get_admin_users", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def get_admin_users(skip: int = 0, limit: int = 25, db: Session = Depends(get_db)):$/", "language": "Python", "kind": "function", "signature": "(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))"}, {"_type": "tag", "name": "get_hosts", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def get_hosts(skip: int = 0, limit: int = 25, db: Session = Depends(get_db)):$/", "language": "Python", "kind": "function", "signature": "(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))"}, {"_type": "tag", "name": "get_visitlogs", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def get_visitlogs(skip: int = 0, limit: int = 25, db: Session = Depends(get_db)):$/", "language": "Python", "kind": "function", "signature": "(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))"}, {"_type": "tag", "name": "get_visitors", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def get_visitors(skip: int = 0, limit: int = 25, db: Session = Depends(get_db)):$/", "language": "Python", "kind": "function", "signature": "(skip: int = 0, limit: int = 25, db: Session = Depends(get_db))"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "input_mode", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    input_mode: str = Field(..., description=\"'voice' or 'text'\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "VisitorCheckinStepRequest", "scopeKind": "class"}, {"_type": "tag", "name": "is_complete", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    is_complete: bool = False$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "VisitorCheckinStepResponse", "scopeKind": "class"}, {"_type": "tag", "name": "language", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    language: Optional[str] = Field(\"en\", description=\"Language code for STT\\/TTS\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "SpeechRequest", "scopeKind": "class"}, {"_type": "tag", "name": "language", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    language: Optional[str] = Field(\"en\", description=\"Language code for TTS\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "TextToSpeechRequest", "scopeKind": "class"}, {"_type": "tag", "name": "next_field", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    next_field: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "VisitorCheckinStepResponse", "scopeKind": "class"}, {"_type": "tag", "name": "notify_host", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def notify_host(body: Dict[str, Any] = Body(...)):$/", "language": "Python", "kind": "function", "signature": "(body: Dict[str, Any] = Body(...))"}, {"_type": "tag", "name": "orm_mode", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^        orm_mode = True$/", "language": "Python", "kind": "variable", "scope": "AdminUserOut.Config", "scopeKind": "class"}, {"_type": "tag", "name": "orm_mode", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^        orm_mode = True$/", "language": "Python", "kind": "variable", "scope": "HostOut.Config", "scopeKind": "class"}, {"_type": "tag", "name": "orm_mode", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^        orm_mode = True$/", "language": "Python", "kind": "variable", "scope": "VisitLogOut.Config", "scopeKind": "class"}, {"_type": "tag", "name": "orm_mode", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^        orm_mode = True$/", "language": "Python", "kind": "variable", "scope": "VisitorOut.Config", "scopeKind": "class"}, {"_type": "tag", "name": "speech_to_text_stub", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^async def speech_to_text_stub(file: UploadFile = File(...), language: Optional[str] = Form(\"en-U/", "language": "Python", "kind": "function", "signature": "(file: UploadFile = File(...), language: Optional[str] = Form(\"en-US\"))"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    text: str = Field(..., description=\"Text to convert to speech\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "TextToSpeechRequest", "scopeKind": "class"}, {"_type": "tag", "name": "text_to_speech_stub", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^async def text_to_speech_stub(request: TextToSpeechRequest):$/", "language": "Python", "kind": "function", "signature": "(request: TextToSpeechRequest)"}, {"_type": "tag", "name": "upload_id_ocr", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^async def upload_id_ocr(file: UploadFile = File(...)):$/", "language": "Python", "kind": "function", "signature": "(file: UploadFile = File(...))"}, {"_type": "tag", "name": "user_input", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^    user_input: str = Field(..., description=\"Current raw input (spoken or typed)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "VisitorCheckinStepRequest", "scopeKind": "class"}, {"_type": "tag", "name": "validate_field", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def validate_field(payload: FieldValidationRequest):$/", "language": "Python", "kind": "function", "signature": "(payload: FieldValidationRequest)"}, {"_type": "tag", "name": "visitor_checkin_finalize", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def visitor_checkin_finalize(payload: Dict[str, Any], db: Session = Depends(get_db)):$/", "language": "Python", "kind": "function", "signature": "(payload: Dict[str, Any], db: Session = Depends(get_db))"}, {"_type": "tag", "name": "visitor_checkin_step", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def visitor_checkin_step(payload: VisitorCheckinStepRequest):$/", "language": "Python", "kind": "function", "signature": "(payload: VisitorCheckinStepRequest)"}, {"_type": "tag", "name": "websocket_usage", "path": "/home/kavia/workspace/code-generation/visitor-check-in-assistant-100434-100452/visitor_management_backend/src/api/main.py", "pattern": "/^def websocket_usage():$/", "language": "Python", "kind": "function", "signature": "()"}], "hash": "b413e88223ea319d821f84becbea5c21", "format-version": 4, "code-base-name": "visitor_management_backend", "filename": "visitor_management_backend/src/api/main.py", "fields": [{"name": "Optional[str] advice", "scope": "VisitorCheckinStepResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bytes audio_data", "scope": "SpeechRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Dict[str, str] conversation_state", "scope": "VisitorCheckinStepRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[List[str]] errors", "scope": "FieldValidationResult", "scopeKind": "class", "description": "unavailable"}, {"name": "str field", "scope": "FieldValidationRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str full_name", "scope": "VisitorCreatePayload", "scopeKind": "class", "description": "unavailable"}, {"name": "str input_mode", "scope": "VisitorCheckinStepRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "bool is_complete", "scope": "VisitorCheckinStepResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] language", "scope": "SpeechRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] next_field", "scope": "VisitorCheckinStepResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "orm_mode = True", "scope": "AdminUserOut.Config", "scopeKind": "class", "description": "unavailable"}, {"name": "str text", "scope": "TextToSpeechRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str user_input", "scope": "VisitorCheckinStepRequest", "scopeKind": "class", "description": "unavailable"}]}